<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Teacher Administration Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="shadcn-styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: hsl(var(--background));
        }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(1, 1fr);
            gap: 1.5rem;
        }
        
        @media (min-width: 640px) {
            .dashboard-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (min-width: 1024px) {
            .dashboard-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
    </style>
</head>
<body class="min-h-screen">
    <div class="flex h-screen bg-gray-50 overflow-hidden">
        <!-- Sidebar container -->
        <div id="sidebar-container" class="w-64 bg-white shadow-md hidden md:block"></div>
        
        <!-- Main container -->
        <div class="flex-1 flex flex-col overflow-hidden">
            <!-- Header container -->
            <div id="header-container"></div>
            
            <!-- Content container -->
            <div class="flex-1 overflow-auto p-4">
                <div class="mb-8">
                    <h2 class="text-2xl font-semibold mb-2">Overview</h2>
                    <p class="text-gray-600">Welcome to your teacher administration dashboard</p>
                </div>
                
                <!-- Dashboard cards grid -->
                <div class="dashboard-grid mb-8">
                    <!-- Class Count -->
                    <div class="bg-white shadow-md rounded-lg p-6">
                        <div class="flex items-center mb-4">
                            <div class="bg-blue-100 p-3 rounded-full mr-4">
                                <svg class="w-6 h-6 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                                </svg>
                            </div>
                            <h3 class="text-lg font-semibold">Kelas</h3>
                        </div>
                        <div class="text-3xl font-bold mb-2" id="kelas-count">-</div>
                        <a href="classes.html" class="text-blue-500 hover:underline text-sm flex items-center">
                            Lihat semua kelas
                            <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                            </svg>
                        </a>
                    </div>
                    
                    <!-- Student Count -->
                    <div class="bg-white shadow-md rounded-lg p-6">
                        <div class="flex items-center mb-4">
                            <div class="bg-green-100 p-3 rounded-full mr-4">
                                <svg class="w-6 h-6 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"></path>
                                </svg>
                            </div>
                            <h3 class="text-lg font-semibold">Siswa</h3>
                        </div>
                        <div class="text-3xl font-bold mb-2" id="siswa-count">-</div>
                        <a href="students.html" class="text-green-500 hover:underline text-sm flex items-center">
                            Lihat semua siswa
                            <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                            </svg>
                        </a>
                    </div>
                    
                    <!-- Assignment Count -->
                    <div class="bg-white shadow-md rounded-lg p-6">
                        <div class="flex items-center mb-4">
                            <div class="bg-purple-100 p-3 rounded-full mr-4">
                                <svg class="w-6 h-6 text-purple-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                                </svg>
                            </div>
                            <h3 class="text-lg font-semibold">Tugas</h3>
                        </div>
                        <div class="text-3xl font-bold mb-2" id="tugas-count">-</div>
                        <a href="assignments.html" class="text-purple-500 hover:underline text-sm flex items-center">
                            Lihat semua tugas
                            <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                            </svg>
                        </a>
                    </div>
                </div>
                
                <!-- Recent activities -->
                <div class="mb-8">
                    <h2 class="text-2xl font-semibold mb-4">Aktivitas Terbaru</h2>
                    <div class="bg-white shadow-md rounded-lg p-6" id="recent-activities">
                        <div class="text-center text-gray-500 py-4">
                            <p>Memuat aktivitas terbaru...</p>
                        </div>
                    </div>
                </div>
                
                <!-- Upcoming events -->
                <div class="mb-8">
                    <h2 class="text-2xl font-semibold mb-4">Event Mendatang</h2>
                    <div class="bg-white shadow-md rounded-lg p-6" id="upcoming-events">
                        <div class="text-center text-gray-500 py-4">
                            <p>Memuat event mendatang...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Scripts -->
    <script src="js/api.js"></script>
    <script src="js/layout.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async function() {
            // Initialize layout
            initLayout();
            updatePageTitle('Dashboard');
            
            try {
                // Load Kelas count
                const kelasResponse = await getAllData('Kelas');
                if (kelasResponse.success) {
                    document.getElementById('kelas-count').textContent = kelasResponse.data.length;
                }
                
                // Load Siswa count
                const siswaResponse = await getAllData('Siswa');
                if (siswaResponse.success) {
                    document.getElementById('siswa-count').textContent = siswaResponse.data.length;
                }
                
                // Load Tugas count
                const tugasResponse = await getAllData('Tugas');
                if (tugasResponse.success) {
                    document.getElementById('tugas-count').textContent = tugasResponse.data.length;
                }
                
                // Load upcoming events
                const eventsResponse = await getAllData('Event');
                if (eventsResponse.success) {
                    renderUpcomingEvents(eventsResponse.data);
                }
                
                // Load recent journals as activities
                const journalsResponse = await getAllData('JurnalPembelajaran');
                if (journalsResponse.success) {
                    renderRecentActivities(journalsResponse.data);
                }
            } catch (error) {
                console.error('Error loading dashboard data:', error);
            }
        });
        
        function renderUpcomingEvents(events) {
            const container = document.getElementById('upcoming-events');
            if (!events || events.length === 0) {
                container.innerHTML = `
                <div class="text-center text-gray-500 py-4">
                    <p>Tidak ada event yang akan datang</p>
                </div>
                `;
                return;
            }
            
            // Sort events by date (ascending)
            events.sort((a, b) => new Date(a.tanggal) - new Date(b.tanggal));
            
            // Filter only upcoming events (today and future)
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            const upcomingEvents = events.filter(event => {
                const eventDate = new Date(event.tanggal);
                eventDate.setHours(0, 0, 0, 0);
                return eventDate >= today;
            }).slice(0, 5); // Limit to 5 upcoming events
            
            if (upcomingEvents.length === 0) {
                container.innerHTML = `
                <div class="text-center text-gray-500 py-4">
                    <p>Tidak ada event yang akan datang</p>
                </div>
                `;
                return;
            }
            
            let html = '<div class="space-y-4">';
            upcomingEvents.forEach(event => {
                html += `
                <div class="flex items-start">
                    <div class="bg-blue-100 text-blue-800 p-2 rounded text-center min-w-[60px] mr-4">
                        <div class="text-sm font-semibold">${formatEventDate(event.tanggal)}</div>
                    </div>
                    <div>
                        <h4 class="font-semibold">${event.nama || 'Untitled Event'}</h4>
                        <p class="text-sm text-gray-600">${event.deskripsi || 'No description'}</p>
                    </div>
                </div>
                `;
            });
            html += '</div>';
            
            container.innerHTML = html;
        }
        
        function formatEventDate(dateString) {
            if (!dateString) return '-';
            const date = new Date(dateString);
            
            // Get month in Indonesian
            const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'Mei', 'Jun', 'Jul', 'Ags', 'Sep', 'Okt', 'Nov', 'Des'];
            
            const day = date.getDate();
            const month = monthNames[date.getMonth()];
            
            return `${day}<br>${month}`;
        }
        
        function renderRecentActivities(journals) {
            const container = document.getElementById('recent-activities');
            if (!journals || journals.length === 0) {
                container.innerHTML = `
                <div class="text-center text-gray-500 py-4">
                    <p>Belum ada aktivitas</p>
                </div>
                `;
                return;
            }
            
            // Sort journals by date (descending)
            journals.sort((a, b) => new Date(b.tanggal) - new Date(a.tanggal));
            
            // Get 5 most recent journals
            const recentJournals = journals.slice(0, 5);
            
            let html = '<div class="space-y-4">';
            recentJournals.forEach(journal => {
                html += `
                <div class="border-l-4 border-blue-500 pl-4">
                    <div class="flex justify-between items-start">
                        <h4 class="font-semibold">${journal.kelas || 'Untitled Class'}</h4>
                        <span class="text-xs text-gray-500">${formatDate(journal.tanggal)}</span>
                    </div>
                    <p class="text-sm">${journal.materi || 'No material'}</p>
                    <p class="text-xs text-gray-600 mt-1">${journal.keterangan || 'No description'}</p>
                </div>
                `;
            });
            html += '</div>';
            
            container.innerHTML = html;
        }
    </script>
</body>
</html> 